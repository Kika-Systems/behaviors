<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | wr-behaviors</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container manual-root manual-index" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/behaviors.html"><a href="manual/behaviors.html" data-ice="link">Behaviors</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/behaviors.html"><a href="manual/behaviors.html#metadata" data-ice="link">Metadata</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/behaviors.html"><a href="manual/behaviors.html#behavior-implementation-overview" data-ice="link">Behavior Implementation Overview</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/behaviors.html"><a href="manual/behaviors.html#development-workflow" data-ice="link">Development Workflow</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/behaviors.html"><a href="manual/behaviors.html#automated" data-ice="link">Automated</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/behaviors.html"><a href="manual/behaviors.html#manual" data-ice="link">Manual</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/build-system.html"><a href="manual/build-system.html" data-ice="link">Build System</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/build-system.html"><a href="manual/build-system.html#overview" data-ice="link">Overview</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/build-system.html"><a href="manual/build-system.html#initialization" data-ice="link">Initialization</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/build-system.html"><a href="manual/build-system.html#ultimate-build-configuration" data-ice="link">Ultimate build configuration</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/build-system.html"><a href="manual/build-system.html#building-what-resolution" data-ice="link">Building what resolution</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/build-system.html"><a href="manual/build-system.html#ensuring-the-necessary-build-directory-structure-exists" data-ice="link">Ensuring the necessary build directory structure exists</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/build-system.html"><a href="manual/build-system.html#collection" data-ice="link">Collection</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/build-system.html"><a href="manual/build-system.html#building" data-ice="link">Building</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/cli.html"><a href="manual/cli.html" data-ice="link">CLI</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/cli.html"><a href="manual/cli.html#api-command" data-ice="link">API command</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/cli.html"><a href="manual/cli.html#behaviors-command" data-ice="link">Behaviors command</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/cli.html"><a href="manual/cli.html#runner-command" data-ice="link">Runner command</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/cli.html"><a href="manual/cli.html#stdlib-command" data-ice="link">STDLIB command</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html" data-ice="link">Pre-made Behaviors</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#autoscroll" data-ice="link">Autoscroll</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#applies-to" data-ice="link">Applies to</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#behavior" data-ice="link">Behavior</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#specifics" data-ice="link">Specifics</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#instagram" data-ice="link">Instagram</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#gotchas" data-ice="link">Gotchas</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#stories" data-ice="link">Stories</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#user--not-own-feed-" data-ice="link">User (not own feed)</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#applies-to" data-ice="link">Applies to</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#behavior" data-ice="link">Behavior</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#viewing-stories" data-ice="link">Viewing stories</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#viewing-posts" data-ice="link">Viewing posts</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#stopping-condition" data-ice="link">Stopping condition</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#individual-post" data-ice="link">Individual Post</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#applies-to" data-ice="link">Applies to</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#own-feed" data-ice="link">Own Feed</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#applies-to" data-ice="link">Applies to</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#behavior" data-ice="link">Behavior</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#stopping-condition" data-ice="link">Stopping condition</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#twitter" data-ice="link">Twitter</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#gotchas" data-ice="link">Gotchas</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#timeline" data-ice="link">Timeline</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#behavior" data-ice="link">Behavior</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#stopping-condition" data-ice="link">Stopping condition</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#hashtags" data-ice="link">HashTags</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#applies-to" data-ice="link">Applies to</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#behavior" data-ice="link">Behavior</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#stopping-condition" data-ice="link">Stopping condition</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#youtube-video" data-ice="link">Youtube Video</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#applies-to" data-ice="link">Applies to</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/premade-behaviors.html"><a href="manual/premade-behaviors.html#behavior" data-ice="link">Behavior</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  <div class="manual-user-index" data-ice="manualUserIndex"><h1 id="behaviors">Behaviors</h1><h2 id="quick-start">Quick Start</h2><p>Requirements: <a href="https://nodejs.org/en/">Node.js</a></p>
<p>To use this project you must first install its dependencies</p>
<pre><code class="lang-bash"><code class="source-code prettyprint">$ yarn install
# or &quot;npm install&quot;</code>
</code></pre>
<p>Once you have installed the dependencies you are ready to start using the project</p>
<h2 id="via-docker">Via Docker</h2><p>To build the behaviors docker image (<code>webrecorder/behaviors:latest</code>) execute <code>docker-compose build</code>.</p>
<p>The image created is suitable for building behaviors and running the behavior api server.</p>
<p>The default configuration of the image is to run the api server, however you can substitute the default command
with any of the cli commands listed previously.</p>
<p>For more information please consult the provided <code>Dockerfile</code> and <code>docker-compose.yml</code> files.</p>
</div>

  

  <div class="manual-cards">
    
  <div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Behaviors</h1><p>A behavior is simply a JavaScript file that exposes the means to perform its series of actions in a page and some information (metadata) about itself.</p><p>With this in mind, every behavior is expected to be <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">JavaScript module</a> that</p><ul>
<li>has a <strong>default export</strong> that is an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of#Iterating_over_async_generators">async generator function</a> or a function returning an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/asyncIterator">async iterator</a></li>
<li>has named export <strong>metadata</strong> that is an object</li>
<li>has named export <strong>isBehavior</strong></li>
</ul><p>The an example of the expected format behavior is shown below</p><pre><code class="lang-js"><code class="source-code prettyprint">// means to perform the series of  actions
export default async function* myBehavior() { ... }

// information about the behavior
export const metadata = { ... };

// flag indicating this file is a behavior ready to be used
export const isBehavior = true;</code>
</code></pre><p>In the example above, the behavior exposes the means to perform its actions using the <code>export default</code> keywords.</p><p>The <code>export default</code> keywords indicate that whatever follows is the primary export of the module and what ever is default export of a behavior is used to run the behavior.</p><p>Any additional information that the behavior wishes to be expose using the <code>export</code> keyword and is shown in the example above with the final two required named exports <strong>metadata</strong> and <strong>isBehavior</strong>.</p><p>Please note that <strong>isBehavior</strong> named export is used to indicate that this behavior is ready to be used.</p><p>If the <strong>isBehavior</strong> export is missing then the provided tools will not recognize the behavior as being ready and will not use the behavior.</p><p>Likewise, if the behavior does not have a default export and does not export <strong>metadata</strong> and <strong>isBehavior</strong>, the tools will not consider the behavior as valid.</p><p>The optional export <code>postStep</code> must be function and is called after each action (step) of the behavior.</p><h2>Metadata</h2><p>A behaviors exported metadata is used to</p><ul>
<li>describe how it should be matched to the pages it is written for</li>
<li>provide an overview of what it does</li>
<li>have a more specific name associated with it when querying for it using the behavior api</li>
<li>embed any additional information about the behavior</li>
</ul><p>And every exported metadata object is expected to have the following properties</p><ul>
<li>name (string): the name for your behavior to be used when querying the behavior API for it by name</li>
<li>description (string): a description for the behavior</li>
<li>match (object): how the behavior will be matched to the page(s) it is written for</li>
</ul><p>Of the expected metadata properties, the match object has two variations and is shown below in the context of two valid metadata exports.</p><pre><code class="lang-js"><code class="source-code prettyprint">// variation 1
export const metadata = {
  name: &apos;the name of your behavior&apos;,
  match: {
    regex: /an regular expression dictating the URL the behavior will run on/,
  },
  description: &apos;an description of what your behavior does&apos;,
};</code>
</code></pre><p>The first variation, shown above, defines a single property <code>regex</code> that is an JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">RegExp</a>.</p><p>The behavior using variation one is considered matched to an URL when the regular expression, defined in the <code>regex</code> property of <code>match</code>, matches the URL.</p><p>The second variation, shown below, has two properties <code>base</code> (RegExp) and <code>sub</code> (Array&lt;RegExp&gt;).</p><p>The <code>base</code> regular expression is used as a generic test and if it matches a URL the regular expressions in the <code>sub</code> array will be tested against the same URL.</p><p>The behavior is considered matched to a URL when the <code>base</code> regular expression matches the URL and one of the <code>sub</code> regular expressions matches the URL.</p><pre><code class="lang-js"><code class="source-code prettyprint">// variation 2
export const metadata = {
  name: &apos;the name of your behavior&apos;,
  match: {
    regex: {
      base: /an regular expressions dictating the base URL the behavior will run on/,
      sub: [
        /an array of regular expressions dictating more specific parts of the base URL the behavior will run on/,
      ],
    },
  },
  description: &apos;an description of what your behavior does&apos;,
};</code>
</code></pre><h2>Behavior Implementation Overview</h2><p>The primary reasons that a behaviors <strong>default export</strong> is required to be an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of#Iterating_over_async_generators">async generator function</a> or a function returning an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/asyncIterator">async iterator</a> are</p><ul>
<li>Async generators are a native JavaScript feature cross the major browser</li>
<li>They provide a simple way to run the behavior via in the browser and via <a href="https://github.com/webrecorder/browsertrix">browsertrix</a></li>
<li>Allow information about the behavior, its state, to be easily reported to behavior runners</li>
</ul><p>However we understand this requirement, namely behaviors as async generators, may be a new JavaScript idiom for some and for the remaining portion of this section give a high level overview on how to write a behavior under this requirement.</p><p>Now consider the following example shown below which is a behavior living in the in the &quot;behaviors&quot; directory of this project for all pages of myAwesomeWebSite.com.</p><p>Please note that there is no code in the body of the <code>myBehavior</code> function, this is ok as all the remaining code examples should be assumed to be inside function where the comment &quot;behavior code&quot; is currently.</p><pre><code class="lang-js"><code class="source-code prettyprint">import * as lib from &apos;../lib&apos;;

export default async function* myBehavior() {
  // behavior code
}

export const metadata = {
  name: &apos;myBehavior&apos;,
  match: {
    regex: /^(?:https?:\/\/(?:www\.)?)?:myAwesomeWebSite.com.*$/,
  },
  description: &apos;It does really cool stuff&apos;,
};

export const isBehavior = true;</code>
</code></pre><p>As you will have already noticed by looking over the documentation for the <a href="https://webrecorder.github.io/behaviors/">behaviors standard library</a> that many of the functions returns <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a>.</p><p>Now without turning into a JavaScript tutorial the only thing you need to know about promises is that they can be awaited, that is to say you can await for their completion.</p><p>This comes in handy when you want to wait for the the documents state to become ready since the pages of myAwesomeWebSite.com take a long time to load and can be done as easily as shown in <code>step 1</code></p><pre><code class="lang-js"><code class="source-code prettyprint">// step 1
await lib.domCompletePromise();</code>
</code></pre><p>Now we know that the browser has fully parsed the page and we can safely start operating on the page.</p><p>But first we should let ourselves know that we are good to go by reporting some state and is done by yielding a value as shown in <code>step 2</code></p><pre><code class="lang-js"><code class="source-code prettyprint">// step 1
await lib.domCompletePromise();
// step 2
const state = { videosPlayed: 0 };
yield lib.stateWithMsgNoWait(&apos;Document ready!&apos;, state);</code>
</code></pre><p>The function <code>lib.stateWithMsgNoWait</code> indicates to the behavior runner that the behavior has an updated to report and that it does not have to wait.</p><p>If the behavior was being run by <a href="https://github.com/webrecorder/browsertrix">browsertrix</a> and the other function <code>lib.stateWithMsgWait</code> was used, browsertrix would have waited until the HTTP requests made by the page had died down (no request made for set period of time) but since we use the no wait variant we know no wait will be made.</p><p>When you <code>yield</code> a value from the behavior you can consider the behavior paused until the runner initiates an the next action.</p><p>If a wait was indicated using the <code>lib.stateWithMsgWait</code> and the behavior is being run by browsertrix no more actions would be initiated until the pages network (amount of HTTP requests made) become idle (no more requests made for a set period of time).</p><p>Additionally, it should be noted that the second argument supplied to <code>lib.stateWithMsgNoWait</code> is optional but useful for reporting to yourself more detailed information about the state of your behavior.</p><p>Continuing on with the creation of our behavior, let us assume that the page that the behavior is operating in has a list videos we want to play.</p><p>We can accomplish this as shown in <code>step 3</code></p><pre><code class="lang-js"><code class="source-code prettyprint">// step 1
await lib.domCompletePromise();
// step 2
const state = { videosPlayed: 0 };
yield lib.stateWithMsgNoWait(&apos;Document ready!&apos;, state);
// step 3
for (const videoListItem of lib.childElementIterator(lib.id(&apos;videos&apos;))) {
  // videoListItem is a child of the element with id == &apos;videos&apos;
  // that has a video as child element
  await lib.selectAndPlay(&apos;video&apos;, videoListItem);
  // increment our states counter for number of videos played
  state.videosPlayed += 1;
  // let ourselves know we played a video
  yield lib.stateWithMsgNoWait(&apos;Played a video!&apos;, state);
}
return lib.stateWithMsgNoWait(&apos;Done!&apos;, state);</code>
</code></pre><p>In step three we use the function <code>traverseChildrenOf</code> which will apply the supplied function to all child elements of the first argument.</p><p>Also seen in step 3 is the usage keyword <code>yield</code> in combination with <code>*</code> or <code>yield *</code>.</p><p><code>yield *</code> means that we are yielding another generator, that is to say all actions of the generator are to be treated as if we yielded them ourselves.</p><p>In short step 3 can be described as playing a video contained in every child of the element with id == video and once we have played all the videos on the page return a message with our final state from the behavior.</p><p>This completes the mini-tutorial on how to create behaviors.</p><p>The full behavior is shown below</p><pre><code class="lang-js"><code class="source-code prettyprint">import * as lib from &apos;../lib&apos;;

export default async function* myBehavior() {
  // behavior code
  // step 1
  await lib.domCompletePromise();
  // step 2
  const state = { videosPlayed: 0 };
  yield lib.stateWithMsgNoWait(&apos;Document ready!&apos;, state);
  // step 3
  for (const videoListItem of lib.childElementIterator(lib.id(&apos;videos&apos;))) {
    // videoListItem is a child of the element with id == &apos;videos&apos;
    // that has a video as child element
    await lib.selectAndPlay(&apos;video&apos;, videoListItem);
    // increment our states counter for number of videos played
    state.videosPlayed += 1;
    // let ourselves know we played a video
    yield lib.stateWithMsgNoWait(&apos;Played a video!&apos;, state);
  }
  return lib.stateWithMsgNoWait(&apos;Done!&apos;, state);
}

export const metadata = {
  name: &apos;myBehavior&apos;,
  match: {
    regex: /^(?:https?:\/\/(?:www\.)?)?:myAwesomeWebSite.com.*$/,
  },
  description: &apos;It does really cool stuff&apos;,
};

export const isBehavior = true;</code>
</code></pre><h2>Development Workflow</h2><h3>Automated</h3><p>The simplest way to both develop and run a behavior on the target page is to use the provided behavior runner cli and a run configuration file (<a href="./manual/./cli.html#runner-command">more details</a>).</p><p>To help you get started a behavior run configuration file, <code>behavior-run-config.yml</code> found at the root of this project, has been provided for you.</p><p>By using the provided configuration file all that is required is to change two fields:</p><ul>
<li>behavior: the path to your new behavior in the behavior directory of this project</li>
<li>url: the url of the page your behavior should be run in</li>
</ul><p>Once you have changed those two you fields you can start the build and run process by either executing one of the following from the root directory of this project</p><ul>
<li><code>./bin/cli runner -c behavior-run-config.yml</code></li>
<li><code>./bin/cli-runner -c behavior-run-config.yml</code></li>
</ul><p>The command will launch a Chrome/Chromium browser installed on your computer, build the behavior, and then run it until completion.</p><p>While the behavior is being run or the behavior has run to completion and a change has been detected to the behavior 
or any of the files it includes, it will be rebuilt and re-run automatically.</p><h3>Manual</h3><p>To build the behavior execute the following command <code>./bin/cli-behaviors -b ./behaviors/&lt;path to your behavior&gt;</code>.
Once the command exits the behavior ready to be run can be found at <code>./dist/&lt;behavior name&gt;.js</code> or you can use copy the path displayed
in the output of the build command.</p><p>The next step is to copy the contents of the generated file into the browser and run it.</p><p>The generated file contains JavaScript that will setup the behavior for running using an utility class exposed on <code>window</code> as <code>$WBBehaviorRunner$</code>.</p><p>Shown below are the ways provided for you to manually run the behavior by the utility class.</p><pre><code class="lang-js"><code class="source-code prettyprint">/* automatic running */

for await (const state of $WBBehaviorRunner$.autoRunIter()) { 
  console.log(state); 
}

await $WBBehaviorRunner$.autoRun({logging: true})

await $WBBehaviorRunner$.autoRunWithDelay({logging: true})

/* manually initiate each step of the behavior */
await $WBBehaviorRunner$.step()</code>
</code></pre><p>The <code>autoRunIter</code> function accepts a single optional argument delayAmount (number), which is a time value in milliseconds that will be applied after each action (step) of the behavior.</p><p>Both the <code>autoRun</code> and <code>autoRunWithDelay</code> methods accept a single optional argument options (object) with one exception, <code>autoRunWithDelay</code> defaults to applying a one second delay after each action if no delay was specified.</p><p>The full configuration options for these two methods are displayed below </p><ul>
<li>delayAmount (number, defaults to 1000):  Time value in milliseconds representing how much time should be waited after initiating a behavior&apos;s step</li>
<li>noOutlinks (boolean, defaults to true): Should the collection of outlinks be disabled when running the behavior</li>
<li>logging (boolean, defaults to true): Should information the behavior sends be displayed</li>
</ul><p>If you use one of the three way to &quot;automatically&quot; run the behavior and you wish to pause it while it is running set <code>window.$WBBehaviorPaused</code> to true and to un-pause it set <code>window.$WBBehaviorPaused</code> to false.</p></div>
        <a data-ice="link" href="manual/behaviors.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Build System</h1><h2>Overview</h2><p>The behavior build process has three phases</p><ul>
<li>Initialization </li>
<li>Collection</li>
<li>Building</li>
</ul><h2>Initialization</h2><p>Initialization has three steps</p><ol>
<li>Ultimate build configuration</li>
<li>Building what resolution</li>
<li>Ensuring the necessary build directory structure exists</li>
</ol><h4>Ultimate build configuration</h4><p>The ultimate build configuration is created in combination with user supplied cli options using the following steps</p><ol>
<li>If a config was specified using <code>-c, --config</code> it is used </li>
<li>If the default config exists in the current working directory of the commands it used </li>
<li>Otherwise the path to the behavior file or dir (<code>-b, --build [fileOrDir]</code>) is used and the six config values are set to the project defaults </li>
</ol><p>When a config file is used each of the six values from the config file are resolved as follows </p><ul>
<li>if the key exists and value is relative, make absolute by resolving it against the directory containing the config file</li>
<li>if the key exists and is absolute, use key value</li>
<li>if key does not exist use project default value<ul>
<li>build, dist: <code>&lt;directory containing config&gt;/&lt;name&gt;</code></li>
<li>lib, tsconfig: projects default value</li>
<li>metadata: placed in current working directory </li>
</ul>
</li>
</ul><p>Once the ultimate build configuration has been created, the build process proceeds to the next step.</p><h4>Building what resolution</h4><p>The determination for what is being built is done using the value for the <code>-b, --build</code> cli option and that value can be one of two types</p><ul>
<li><code>boolean</code>: build all behaviors found in the value for the <code>behaviors</code> key from the supplied build config </li>
<li><code>string</code>: path to a directory containing behaviors or a single behavior to be built</li>
</ul><p>When the value for build is <code>boolean</code></p><ul>
<li>If the directory supplied via the <code>behaviors</code> config key exists, the what is being built is that directory and the initialization process contains to the next step</li>
<li>Otherwise the directory supplied via the <code>behaviors</code> config key does not exist the build process is ended</li>
</ul><p>When the value for build is a <code>string</code> and an absolute path </p><ul>
<li>If the path exists, the what is being built is that directory or file and the initialization process contains to the next step</li>
<li>Otherwise the path does not exist the build process is ended</li>
</ul><p>When the value for build is a <code>string</code> and an relative path, it is resolved in the following order</p><ol>
<li>the value as is resolved using node&apos;s relative path resolution algorithm. Note this value is used by other steps if previous ones fail and is denoted as <code>resolvedPath</code></li>
<li>the value as is joined with the supplied configs behavior dir or projects default behavior dir</li>
<li>the value as is joined with the the current working directory</li>
<li><code>resolvedPath</code> joined with the supplied configs behavior dir or projects default behavior dir</li>
<li><code>resolvedPath</code> joined with the current working directory</li>
</ol><p>If any of the absolute paths described above exist, the what is being built is the resolved path and the initialization process contains to the next step otherwise the build process is ended</p><h4>Ensuring the necessary build directory structure exists</h4><p>The final step in the initialization process is to ensure that the <code>build</code> and <code>dist</code> directories exist.</p><p>These values may differ from the names used previously only when they are supplied by the user in a build config file.</p><p>The <code>build</code> directory is used to hold intermediate files used by the build system in order to setup the behavior for final building and usage by other tools such as our own running system.</p><p>Any setup in order to facilitate running the behavior is done here.</p><p>The <code>dist</code> directory is where the built, bundled, behaviors are placed alongside their metadata if configured to do so.</p><h2>Collection</h2><p>The collection phase operates in one of two modes</p><ul>
<li><code>single behavior</code>: when the <code>what is being built</code> path resolves to file </li>
<li><code>multi-behavior</code>: when the <code>what is being built</code> path resolves to a directory</li>
</ul><p>The primary difference between modes is that <code>multi-behavior</code> mode considers every file contained in the directory and its descendant directories.</p><p>Both modes use the same means in determining if a file is indeed a behavior which is as follows</p><ul>
<li>the file is an es module</li>
<li>has a <code>metadata</code> or <code>metaData</code> named export </li>
<li>has a <code>isBehavior</code> named export    </li>
</ul><p>Once the behavior(s) have been collected a report is printed stating how many behaviors were found and if any of the files considered partially met the requirements for collection. </p><p><strong>Note</strong>: Both the collection and building phases share modes with the mode operating under set by the collection phase. </p><h2>Building</h2><p>The building phase can be described in the following steps:</p><ol>
<li>Extract behaviors metadata</li>
<li>Create the behavior&apos;s intermediate file </li>
<li>Use build behavior using rollup</li>
<li>Once all behaviors have been built generate behavior metadata.</li>
</ol><p>The previous steps are applied to all behaviors returned by the collection phase</p></div>
        <a data-ice="link" href="manual/build-system.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>CLI</h1><p>A cli is provided to help you use this project.</p><p>The commands available to you are displayed below </p><pre><code><code class="source-code prettyprint">$ ./bin/cli --help

Usage: cli [options] [command]

Options:
  -V, --version                        output the version number
  -h, --help                           output usage information

Commands:
  api [options]                        Start the behavior api sever
  behaviors [options]                  Build and or validate behaviors, or generate their metadata
  runner [options] &lt;path-to-behavior&gt;  Run and or build a behaviors
  stdlib [options]                     Commands specific to working with the behavior&apos;s std library
  help [cmd]                           display help for [cmd]</code>
</code></pre><p>The cli provides four commands <code>api</code>, <code>behaviors</code>, <code>runner</code>, and <code>stdlib</code> and each command has its own options.</p><h2>API command</h2><p>To run the behavior api server execute <code>./bin/cli api --build-behaviors</code>. </p><p>This will start the api server after all behaviors provided by wr-behaviors have been built. </p><p>If you have already built the behaviors using the <code>behaviors</code> command provided by the cli then you may omit the <code>--build-behaviors</code> flag. </p><p>The full options that available for use with this command are show below.</p><pre><code><code class="source-code prettyprint">$ ./bin/cli api --help

Usage: cli-api [options]

Options:
  -V, --version                        output the version number
  -p, --port [port]                    The port the api server is to bind to (default: 3030)
  -h, --host [host]                    The host address the server is listen on (default: &quot;127.0.0.1&quot;)
  -b, --behaviorDir [behaviorDir]      The path to the directory containing the build behaviors (default: &quot;&lt;cwd&gt;/dist&quot;)
  -m, --behaviorMetadata [medataPath]  The path to the behavior metadata (default: &quot;&lt;cwd&gt;/dist/behaviorMetadata.js&quot;)
  --build-behaviors                    Should the api server build the behaviors for starting up
  -h, --help                           output usage information</code>
</code></pre><p>Some configuration of the api server can be done via the environment variables listed below</p><ul>
<li><code>BEHAVIOR_API_HOST</code>: the host the api server will use (e.g. 127.0.0.1)</li>
<li><code>BEHAVIOR_API_PORT</code>: the port the api server will listen on (e.g. 3030)</li>
<li><code>WR_BEHAVIOR_DIR</code>: path to the directory containing the built behaviors</li>
<li><code>WR_BEHAVIOR_METADATA_PATH</code>: path to the behavior metadata file</li>
<li><code>BUILD_BEHAVIORS</code>: should the api server build the behaviors before starting</li>
</ul><h2>Behaviors command</h2><p>To build the behaviors made available by the project execute <code>./bin/cli behaviors -b</code>.</p><p>This will build the behaviors using the behavior config file located in the root of this project.</p><p>The built behaviors, along with a behavior metadata file (<code>behaviorMetadata.js</code>), can be found in the <code>dist</code> directory which will be created for you if it does not exist in the root of this project.</p><p>The full options that available for use with this command are show below.</p><pre><code><code class="source-code prettyprint">$ ./bin/cli behaviors --help

Usage: cli-behaviors [options]

Options:
  -V, --version                    output the version number
  -v, --validate [fileOrDir]       
  -c, --config [configPath]        Path to the behavior config file (default: &quot;&lt;cwd&gt;/dist/behavior-config.yml&quot;)
  -b, --build [fileOrDir]          Build a behaviors or all behaviors contained within a directory (default: true)
  -w, --watch [behaviorFileOrDir]  Watch the files, and their imports, in the build directory for re-bundling on changes (placed in dist directory)
  --metadata [dumpDir]             Generate behavior metadata, optionally supplying a path to directory where metadata is to be placed. Defaults to current working directory
  -h, --help                       output usage information</code>
</code></pre><p>The config file has six keys and should specified in the config as <code>key: value</code></p><ul>
<li><code>behaviors</code>: path to the directory containing the un-built behaviors</li>
<li><code>lib</code>: path to the directory containing the provided behavior library or own library</li>
<li><code>build</code>: path to the directory where the intermediate files will be placed (for running using Webrecorders system)</li>
<li><code>dist</code>: path to directory where the fully built behaviors</li>
<li><code>tsconfig</code>: path to the typescript configuration file used to provide behavior inspection and validation</li>
<li><code>metadata</code>: path to where the behaviors metadata will be placed (either full path to file or directory path)</li>
</ul><p><strong>Note</strong>: Values can be relative path values as long as they are relative to the directory containing the config file. </p><p>A default is provided for you and can be found in the root of the project <code>&lt;path to project&gt;/behavior-config.yml</code> and is the config file this command looks for (in the current working directory) if one is supplied using the <code>-c, --config</code> option.</p><p>When using the default config file this command can be used to build all behaviors using <code>./bin/cli behaviors -b</code>
otherwise, you will need specify your own config <code>./bin/cli behaviors -c &lt;path to your config&gt; -b</code></p><p>For more details concerning the internals of the build process consult the documentation for the <a href="https://github.com/webrecorder/behaviors/wiki/Build-System">build system</a>.</p><h2>Runner command</h2><p>The runner command allows you to automatically run a behavior on a specified URL using a Chrome/Chromium browser installed on your machine.</p><p>The full options that are available are displayed below.</p><pre><code><code class="source-code prettyprint">$ ./bin/cli help runner

Usage: cli-runner [options] [path-to-behavior]

Options:
  -V, --version                                output the version number
  --build-config [behavior build config path]  Path to the behavior config file (default: &quot;&lt;cwd&gt;/behavior-config.yml&quot;)
  -c, --config [run config path]               Path to a behavior&apos;s run config file
  -r, --run                                    Builds and runs the behavior
  -w, --watch                                  Watches the behavior for changes rebuilding and running the behavior on change
  --run-built                                  Runs a previously built behavior
  -s, --slowmo &lt;amount&gt;                        How much slow mo (delay) should be used between behavior steps
  -t, --run-timeout &lt;amount&gt;                   Maximum amount of time a behavior will run
  -e, --chromeEXE &lt;chrome executable&gt;          The chrome executable to be launched rather than attempting to discover / choose the best version of chrome installed
  -u, --url &lt;url&gt;                              URL of the page to run the behavior on
  -h, --help                                   output usage information</code>
</code></pre><p>Please note that in order to provide automatic running of behaviors, this command must be able to launch the Chrome/Chromium browser. In other words, an already running instance of Chrome/Chromium can not be used.</p><p>The simplest way to use this command is through the usage of a config file (yaml format) and can be supplied using the <code>-c</code> or <code>--config</code> flags like so <code>./bin/cli runner -c &lt;path to run config.yaml&gt;</code>.</p><p>An example run config is provided for you and can found in the root of this project (behavior-run-config.yml).  </p><p>The config file has seven keys and should specified in the config as <code>key: value</code></p><ul>
<li><code>buildConfig</code> (required): path to the behavior build config</li>
<li><code>behavior</code> (required): path to the behavior to be run</li>
<li><code>url</code> (required): the URL the behavior will be run on</li>
<li><code>mode</code> (optional): The available modes are<ul>
<li><code>build-watch</code>: build and run the behavior, rebuilds and restarts the behavior on changes to the behavior</li>
<li><code>build</code>: build and run the behavior once (default mode)</li>
<li><code>built</code>: just run the previously built behavior</li>
</ul>
</li>
<li><code>chromeEXE</code> (optional): Chrome/Chromium executable path or command name to be used to launch (defaults to finding acceptable installed executable)</li>
<li><code>timeout</code> (optional): time value in seconds indicating the maximum length of time the behavior will run</li>
<li><code>slomo</code> (optional): time value in seconds indicating how long to wait before initiating the next action of the behavior</li>
</ul><h2>STDLIB command</h2><p>The stdlib command exists as an utility for generating the provided behavior utility library&apos;s <code>index.js</code> file or to create a bundle of all provided library function for debugging.</p><p>The file name of the generated debug script is <code>libOnWindow.js</code> and is placed in root dir of the project.</p><p>The full options that are available are displayed below.</p><pre><code><code class="source-code prettyprint">$ ./bin/cli help stdlib

Usage: cli-stdlib [options]

Options:
  -V, --version   output the version number
  --gen-index     Generate the behavior&apos;s standard library&apos;s index file
  --debug-script  Generate a script that exposes the entirety of the behavior&apos;s standard library on window
  -h, --help      output usage information</code>
</code></pre></div>
        <a data-ice="link" href="manual/cli.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Pre-made Behaviors</h1><h2>Autoscroll</h2><h3>Applies to</h3><p>Pages that do not have a predefined behavior for them</p><h3>Behavior</h3><p>Automatically scroll down the page and captures any embedded content. If more content loads, scrolling will continue until autopilot is stopped by user.</p><h3>Specifics</h3><p>The discovery of media is done by considering the rendered HTML of page at the current scroll position and the playing of the discovered media is done using <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/play">operations</a> defined for HTML media elements. If the page requires a more specific action to be performed in order to play its media, the behavior may fail to play the media and in this case, a more specific behavior should be made in order to handle this condition.</p><h2>Instagram</h2><h3>Gotchas</h3><p>Instagram changes their CSS class names frequently which can potentially cause the behaviors to not be able to view/play media content until they are updated.</p><p>Video posts require application logic to be played consistently.
Gifs are shown via the video element and actual videos are streamed. </p><p><em>Note data request politeness (1 img = 4 requests)</em></p><h3>Stories</h3><p>Requires the viewer to be logged in</p><p>Logged in state detected if the &#x201C;logged-in&#x201D; CSS class is present or the login/sign-up element are not present </p><h3>User (not own feed)</h3><p>Updated: 2019-07-15T22:29:05</p><h4>Applies to</h4><ul>
<li><code>https://(www.)instagram.com/[user name](/)</code></li>
<li><code>https://(www.)instagram.com/[user name](/?query-string)</code></li>
<li><code>https://(www.)instagram.com/[user name](/tagged)(/)</code></li>
</ul><h4>Behavior</h4><ul>
<li>View stories if able</li>
<li>View each post currently visible</li>
<li>If not stopping condition: wait for more rows indefinitely*</li>
</ul><h4>Viewing stories</h4><p>As previously mentioned, a logged in user. 
If there are selected stories (profile picture is clickable) they are viewed first 
If there are normal stories to be viewed they are viewed</p><h4>Viewing posts</h4><p>Video post (gif, traditional video)</p><ul>
<li>video is played and a wait for the user agent to determine if the video can play through all the way is done</li>
</ul><p>Photo post</p><ul>
<li>no &#x201C;special&#x201D; action other than view</li>
</ul><p>Multiple media post</p><ul>
<li>each part of the multi-post is viewed </li>
<li>if video media is contained the video post action is performed before moving to the next part </li>
<li>otherwise photo post action is performed</li>
</ul><p>All post types</p><ul>
<li>all comments and replies to comments are loaded</li>
</ul><h4>Stopping condition</h4><p>Since instagram is a react application we attempt to extract the &#x201C;redux store&#x201D; in order to determine the number of posts by the user and to listen for application state changes that indicate if there are additional &#x201C;pages&#x201D; (more posts) to be retrieved.</p><p>If extraction of the &#x201C;redux store&#x201D; fails or application internals have changed we fall back to a rudimentary post counting scheme.
When not using store the wait for more post rows to be rendered is limited to 1 minute</p><p>The completion condition can be expressed as follows
Store extraction has not failed: There are no more pages to be retrieved and the current row of posts does not have a next sibling
Store extraction failed: The number of posts viewed is &gt;= number of posts by the user and the current row of posts does not have a next sibling</p><h3>Individual Post</h3><h4>Applies to</h4><ul>
<li><code>https://(www.)instagram.com/p/[post-id](/)</code></li>
</ul><p>Behavior
The actions of this behavior are described in the Viewing posts section of the Instagram User behavior</p><h3>Own Feed</h3><p><strong>Note</strong>: Requires logged in viewer</p><p>Unlike viewing of some other users posts the viewing of own feed posts is limited due to instagram not displaying the viewed post in a popup rather you are taken to post page</p><h4>Applies to</h4><ul>
<li><code>https://(www.)instagram.com(/)</code></li>
</ul><h4>Behavior</h4><p>View stories if any are to be had</p><p>For each rendered post: </p><ul>
<li>perform actions described in the Viewing posts section of the Instagram User behavior with one exception, comments cannot be viewed
If stopping condition not met wait for more posts to be loaded at maximum 45 seconds</li>
</ul><h4>Stopping condition</h4><p>The currently viewed post has no next sibling after 45 seconds</p><h2>Twitter</h2><h3>Gotchas</h3><p>Tweet embeds although sometimes viewable inline by clicking on them are shown using an iframe that the behavior does not have access to </p><p>Audio video tweets are streamed and if the media is of significant length waiting for them to become fully loaded may take the entire length of the video or a significantly long period of time (5+ minutes)</p><h3>Timeline</h3><p>Applies to</p><ul>
<li><code>https://(www.)twitter.com(/)</code>  -- Note this requires logged in</li>
<li><code>https://(www.)twitter.com/[user-name](/)</code></li>
</ul><h4>Behavior</h4><p>If the viewed page is marked as sensitive, reveal page</p><p>For each rendered tweet</p><ul>
<li>If tweet marked as sensitive reveal it</li>
<li>If tweet has video play it</li>
</ul><p>Open tweet</p><ul>
<li>If tweet has replies or apart of thread view comments thread parts</li>
</ul><p>If stopping condition is not met wait for more tweets to be loaded</p><h4>Stopping condition</h4><p>The currently viewed tweet does not have a sibling and the pre-rendered stream end or stream failed are made visible</p><h3>HashTags</h3><h4>Applies to</h4><ul>
<li><code>https://(www.)twitter.com/hashtag/[hash-tag](remaining-URL-parts)*</code></li>
</ul><h4>Behavior</h4><p>For each rendered tweet</p><ul>
<li>If tweet marked as sensitive reveal it</li>
<li>If tweet has video play it</li>
<li>Open tweet<ul>
<li>If tweet has replies or apart of thread view comments thread parts</li>
</ul>
</li>
</ul><p>If stopping condition is not met wait for more tweets to be loaded and repeat</p><h4>Stopping condition</h4><p>The currently viewed tweet does not have a sibling and the pre-rendered stream end or stream failed are made visible</p><h2>Youtube Video</h2><h3>Applies to</h3><ul>
<li>https://(www.)youtube.com/watch?v=[remaining-URL-parts]+  </li>
</ul><h3>Behavior</h3><p>Loads the videos additional information</p><p>Plays the video</p><p>Clicks show more replies until all replies have been loaded (if there were replies)</p></div>
        <a data-ice="link" href="manual/premade-behaviors.html"></a>
      </div>
    </div>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
