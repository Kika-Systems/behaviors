<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [LookupWorkerConfig][1]
    -   [Properties][2]
-   [noop][3]
-   [WorkerEvents][4]
-   [promiseResolveReject][5]
-   [arrayFirstElement][6]
    -   [Parameters][7]
-   [LookupWorker][8]
    -   [Parameters][9]
    -   [id][10]
    -   [behaviorInfo][11]
    -   [workerPath][12]
    -   [init][13]
    -   [sendMsg][14]
        -   [Parameters][15]
    -   [terminate][16]
-   [BehaviorLookUp][17]
    -   [Parameters][18]
    -   [conf][19]
    -   [\_workersById][20]
    -   [\_msgIdsToPromises][21]
    -   [init][22]
    -   [nextWorkerId][23]
    -   [lookupBehavior][24]
        -   [Parameters][25]
    -   [info][26]
        -   [Parameters][27]
    -   [infoList][28]
        -   [Parameters][29]
    -   [allInfo][30]
    -   [reloadBehaviors][31]
    -   [shutdown][32]
        -   [Parameters][33]
-   [DefaultPort][34]
-   [DefaultHost][35]
-   [invalidValue][36]
    -   [Parameters][37]
-   [getDefaultPort][38]
-   [getDefaultHost][39]
-   [getDefaultBehaviorDir][40]
-   [getDefaultMetadataPath][41]
-   [getDefaultBuildBehaviorsFlag][42]
-   [defaultNumWorkers][43]
-   [APIConfig][44]
    -   [Properties][45]
-   [config][46]
-   [rootDir][47]
-   [libDir][48]
-   [finalLibDirImportPath][49]
-   [behaviorDir][50]
-   [behaviorDir][51]
-   [buildDir][52]
-   [distDir][53]
-   [tsConfigFilePath][54]
-   [defaultBehaviorMetadataPath][55]
-   [behaviorCLIPath][56]
-   [defaultBehaviorConfigPath][57]
-   [makeFinalBehaviorImportPath][58]
    -   [Parameters][59]
-   [directoryIndexPath][60]
    -   [Parameters][61]
-   [directoryIndexExists][62]
    -   [Parameters][63]
-   [getMdataSymbol][64]
    -   [Parameters][65]
-   [isBehavior][66]
    -   [Parameters][67]
-   [timeDiff][68]
    -   [Parameters][69]
-   [isObject][70]
    -   [Parameters][71]
-   [regexSource][72]
    -   [Parameters][73]
-   [isString][74]
    -   [Parameters][75]
-   [isRegex][76]
    -   [Parameters][77]
-   [isStringOrRegex][78]
    -   [Parameters][79]
-   [isBoolean][80]
    -   [Parameters][81]
-   [ensureJsFileExt][82]
    -   [Parameters][83]
-   [inspect][84]
    -   [Parameters][85]
-   [joinStrings][86]
    -   [Parameters][87]
-   [stringifyArray][88]
    -   [Parameters][89]
-   [numberOrdinalSuffix][90]
    -   [Parameters][91]
-   [serverCom][92]
-   [serverCom][93]
-   [behaviorMetadata][94]
-   [mdataPath][95]
-   [workerId][96]
-   [behaviorMatches][97]
    -   [Parameters][98]
-   [removeItemFromRequireCache][99]
    -   [Parameters][100]
-   [loadBehaviorMdata][101]
-   [createReplyObj][102]
    -   [Parameters][103]
-   [onMsg][104]
    -   [Parameters][105]
-   [findBehavior][106]
    -   [Parameters][107]
-   [lookupBehavior][108]
    -   [Parameters][109]
-   [lookupBehaviorInfo][110]
    -   [Parameters][111]
-   [reloadBehaviors][112]
    -   [Parameters][113]
-   [allBehaviorInfo][114]
    -   [Parameters][115]
-   [behaviorList][116]
    -   [Parameters][117]
-   [prepareBehaviors][118]
    -   [Parameters][119]
-   [initRoutes][120]
    -   [Parameters][121]
-   [initServer][122]
    -   [Parameters][123]

## LookupWorkerConfig

Type: [Object][124]

### Properties

-   `workerPath` **[string][125]** The path to worker's JS file
-   `id` **[number][126]** The id of the worker
-   `behaviorInfo` **[Object][124]** The behavior info to be sent to the worker

## noop

A simple no operation function

## WorkerEvents

The events emitted by a LookupWorker instance

Type: {exit: [symbol][127], error: [symbol][127], message: [symbol][127]}

## promiseResolveReject

Returns an object that allows for the control of promise to be done
externally, that is to say not within the executor

Returns **{resolve: [Function][128], promise: [Promise][129], reject: [Function][128]}** 

## arrayFirstElement

Returns the first element in an array

### Parameters

-   `ar` **[Array][130]&lt;any>** An array of elements

Returns **any** 

## LookupWorker

**Extends EventEmitter**

A thin wrapper around node worker threads

### Parameters

-   `config` **[LookupWorkerConfig][131]** The lookup worker configuration

### id

Type: [number][126]

### behaviorInfo

Type: [Object][124]

### workerPath

Type: [string][125]

### init

Initialize the lookup worker

### sendMsg

Sends a message to the backing worker

#### Parameters

-   `msg` **any** The message to be sent

### terminate

Terminates the lookup worker

Returns **[Promise][129]** 

## BehaviorLookUp

Class that manages the behavior lookup workers, sending lookup messages to
each worker in a round robin fashion.

### Parameters

-   `conf` **[Object][124]** 

### conf

Type: [Object][124]

### \_workersById

Type: [Map][132]&lt;[number][126], [LookupWorker][133]>

### \_msgIdsToPromises

Type: [Map][132]&lt;[string][125], {resolve: [function][128], reject: [function][128]}>

### init

Initialize the behavior lookup manager

### nextWorkerId

Returns the id of the next worker to send a message to in a round robin
fashion.

Returns **[number][126]** 

### lookupBehavior

Initiates a behavior lookup action returning, a promise containing the
results of this action that resolves once the results of this action have
been received

#### Parameters

-   `request` **[Object][124]** The request initiating this action

Returns **[Promise][129]&lt;[string][125]>** 

### info

Initiates a behavior info lookup action, returning a promise containing the
results of this action that resolves once the results of this action have
been received

#### Parameters

-   `request` **[Object][124]** The request initiating this action

Returns **[Promise][129]&lt;[Object][124]>** 

### infoList

Initiates a behavior info lookup action, returning a promise containing the
results of this action that resolves once the results of this action have
been received

#### Parameters

-   `request` **[Object][124]** The request initiating this action

Returns **[Promise][129]&lt;[Object][124]>** 

### allInfo

Initiates a behavior info lookup action, returning a promise containing the
results of this action that resolves once the results of this action have
been received

Returns **[Promise][129]&lt;[Object][124]>** 

### reloadBehaviors

Sends the reload behaviors message to all backing workers, returning a
promise containing the results of this action that resolves once the
results of this action have been received

Returns **[Promise][129]&lt;[Object][124]>** 

### shutdown

Initiates shut down by terminating all workers, returning a promise that
resolves once all workers have been terminated.

#### Parameters

-   `done` **[Function][128]??** Optional callback called once shutdown is
    complete

## DefaultPort

The default api server port

Type: [number][126]

## DefaultHost

The default api server host

Type: [string][125]

## invalidValue

Prints a warning for invalid environment config values

### Parameters

-   `key` **[string][125]** 
-   `value` **[string][125]** 
-   `defaultValue` **any** 

## getDefaultPort

Returns the default port the api server will listen on.
If the env variable BEHAVIOR_API_PORT is set returns it's value
otherwise returns 3030

Returns **[number][126]** 

## getDefaultHost

Returns the default port the api server will listen on.
If the env variable WR_BEHAVIOR_HOST is set returns its value
otherwise returns 127.0.0.1

Returns **[string][125]** 

## getDefaultBehaviorDir

Returns the default path to the behaviors.
If the env key `WR_BEHAVIOR_DIR` is defined that value is used
otherwise `internalPaths.distDir`

Returns **[string][125]** 

## getDefaultMetadataPath

Returns the default path to the behavior metadata file.
If the env key `WR_BEHAVIOR_METADATA_PATH` is defined that value is used
otherwise `internalPaths.defaultBehaviorMetadataPath`

Returns **[string][125]** 

## getDefaultBuildBehaviorsFlag

Returns the default value for the build behaviors flag.
If the env key `BUILD_BEHAVIORS` is defined that value is used
otherwise false.

Returns **[boolean][134]** 

## defaultNumWorkers

Returns the default value for the number of behavior lookup workers.
If the env key `NUM_WORKERS`

Returns **[number][126]** 

## APIConfig

Type: [Object][124]

### Properties

-   `host` **[string][125]** 
-   `port` **[number][126]** 
-   `numLookupWorkers` **[number][126]** 
-   `fastifyOpts` **{trustProxy: [boolean][134], maxParamLength: [number][126], logger: [boolean][134], querystringParser: any}** 
-   `behaviorInfo` **{build: [boolean][134], mdataPath: [string][125], behaviorDir: [string][125]}** 

## config

The behavior API server config object

Type: [APIConfig][135]

## rootDir

Type: [string][125]

## libDir

Type: [string][125]

## finalLibDirImportPath

Type: [string][125]

## behaviorDir

Type: [string][125]

## behaviorDir

Type: [string][125]

## buildDir

Type: [string][125]

## distDir

Type: [string][125]

## tsConfigFilePath

Type: [string][125]

## defaultBehaviorMetadataPath

Type: [string][125]

## behaviorCLIPath

Type: [string][125]

## defaultBehaviorConfigPath

Type: [string][125]

## makeFinalBehaviorImportPath

### Parameters

-   `behaviorFilePath` **[string][125]** 

Returns **[string][125]** 

## directoryIndexPath

### Parameters

-   `dirPath` **[string][125]** 

Returns **[string][125]** 

## directoryIndexExists

### Parameters

-   `dirPath` **[string][125]** 

Returns **[Promise][129]&lt;[boolean][134]>** 

## getMdataSymbol

Returns the symbol for the metadata export if it exists from the supplied
source files symbol

### Parameters

-   `moduleSymbol`  

## isBehavior

Determines if the supplied source file is for a behavior or not

### Parameters

-   `sourceFile` **SourceFile** 

Returns **[boolean][134]** The results of the is behavior check

## timeDiff

### Parameters

-   `startTime` **[Array][130]&lt;[number][126]>** 

Returns **[string][125]** 

## isObject

### Parameters

-   `object` **any** 

Returns **[boolean][134]** 

## regexSource

### Parameters

-   `object` **([string][125] \| [RegExp][136])** 

Returns **[string][125]** 

## isString

### Parameters

-   `obj` **any** 

Returns **[boolean][134]** 

## isRegex

### Parameters

-   `obj` **any** 

Returns **[boolean][134]** 

## isStringOrRegex

### Parameters

-   `obj` **any** 

Returns **[boolean][134]** 

## isBoolean

### Parameters

-   `obj` **[Object][124]?** 

Returns **[boolean][134]** 

## ensureJsFileExt

### Parameters

-   `filePath` **[string][125]** 

Returns **[string][125]** 

## inspect

### Parameters

-   `obj` **any** 
-   `opts` **[Object][124]?** 

Returns **[string][125]** 

## joinStrings

### Parameters

-   `msgs` **...[string][125]** 

Returns **[string][125]** 

## stringifyArray

### Parameters

-   `array` **[Array][130]&lt;any>** 
-   `joiner` **[string][125]?** 

## numberOrdinalSuffix

### Parameters

-   `num` **[number][126]** 

Returns **[string][125]** 

## serverCom

Type: [MessagePort][137]

## serverCom

Type: [MessagePort][137]

## behaviorMetadata

Type: [Object][124]

## mdataPath

Type: [string][125]

## workerId

Type: [number][126]

## behaviorMatches

Returns T/F indicating if the supplied URL matches a behaviors match object

### Parameters

-   `query` **[Object][124]** The URL to match to a behavior
-   `behavior` **[Object][124]** A behavior

Returns **[boolean][134]** 

## removeItemFromRequireCache

Removes the supplied item from the require cache

### Parameters

-   `item` **[string][125]** The item to be removed from the require cache

## loadBehaviorMdata

Loads the behavior metadata

## createReplyObj

Simply creates the reply message object in order to simplify
the reply format

### Parameters

-   `msg` **[Object][124]** 

Returns **{workerId: [number][126], wasError: [boolean][134], id: [string][125], results: any, errorMsg: [string][125]?}** 

## onMsg

Handles messages sent to the LookupWorker from the parent process

### Parameters

-   `msg` **[Object][124]** The message sent to the worker
    from the parent process

Returns **([Promise][129]&lt;void> | void)** 

## findBehavior

Attempts to find a matching behavior returning the matching behavior
if a match was made otherwise the default behavior

### Parameters

-   `query` **[Object][124]** The message sent to the LookupWorker from the
    parent process

Returns **[Object][124]** 

## lookupBehavior

Performs the behavior lookup action

### Parameters

-   `msg` **[Object][124]** The message sent to the LookupWorker from the
    parent process

Returns **[Promise][129]&lt;void>** 

## lookupBehaviorInfo

Performs the behavior info lookup action

### Parameters

-   `msg` **[Object][124]** The message sent to the LookupWorker from the
    parent process

Returns **[Promise][129]&lt;void>** 

## reloadBehaviors

Reloads the behaviors

### Parameters

-   `msg` **[Object][124]** The message sent to the LookupWorker from the
    parent process

## allBehaviorInfo

Replies with the metadata of all behaviors

### Parameters

-   `msg` **[Object][124]** The message sent to the LookupWorker from the
    parent process

## behaviorList

Like [lookupBehaviorInfo][110] except that this function replies
with a list of matching behaviors (direct matches, default behavior)

### Parameters

-   `msg` **[Object][124]** The message sent to the LookupWorker from the
    parent process

## prepareBehaviors

Builds the behaviors if the behavior API server config indicates to do so,
returning a Promise that resolves once the behaviors have been built otherwise resolves immediately.

### Parameters

-   `config` **[Object][124]** The behavior API server config

Returns **[Promise][129]&lt;any>** 

## initRoutes

Setups the behavior API routes

### Parameters

-   `server` **fastify.FastifyInstance** 
-   `behaviorLookUp` **[BehaviorLookUp][138]** 

## initServer

### Parameters

-   `config` **[Object][124]** 

Returns **[Promise][129]&lt;fastify.FastifyInstance>** 

[1]: #lookupworkerconfig

[2]: #properties

[3]: #noop

[4]: #workerevents

[5]: #promiseresolvereject

[6]: #arrayfirstelement

[7]: #parameters

[8]: #lookupworker

[9]: #parameters-1

[10]: #id

[11]: #behaviorinfo

[12]: #workerpath

[13]: #init

[14]: #sendmsg

[15]: #parameters-2

[16]: #terminate

[17]: #behaviorlookup

[18]: #parameters-3

[19]: #conf

[20]: #_workersbyid

[21]: #_msgidstopromises

[22]: #init-1

[23]: #nextworkerid

[24]: #lookupbehavior

[25]: #parameters-4

[26]: #info

[27]: #parameters-5

[28]: #infolist

[29]: #parameters-6

[30]: #allinfo

[31]: #reloadbehaviors

[32]: #shutdown

[33]: #parameters-7

[34]: #defaultport

[35]: #defaulthost

[36]: #invalidvalue

[37]: #parameters-8

[38]: #getdefaultport

[39]: #getdefaulthost

[40]: #getdefaultbehaviordir

[41]: #getdefaultmetadatapath

[42]: #getdefaultbuildbehaviorsflag

[43]: #defaultnumworkers

[44]: #apiconfig

[45]: #properties-1

[46]: #config

[47]: #rootdir

[48]: #libdir

[49]: #finallibdirimportpath

[50]: #behaviordir

[51]: #behaviordir-1

[52]: #builddir

[53]: #distdir

[54]: #tsconfigfilepath

[55]: #defaultbehaviormetadatapath

[56]: #behaviorclipath

[57]: #defaultbehaviorconfigpath

[58]: #makefinalbehaviorimportpath

[59]: #parameters-9

[60]: #directoryindexpath

[61]: #parameters-10

[62]: #directoryindexexists

[63]: #parameters-11

[64]: #getmdatasymbol

[65]: #parameters-12

[66]: #isbehavior

[67]: #parameters-13

[68]: #timediff

[69]: #parameters-14

[70]: #isobject

[71]: #parameters-15

[72]: #regexsource

[73]: #parameters-16

[74]: #isstring

[75]: #parameters-17

[76]: #isregex

[77]: #parameters-18

[78]: #isstringorregex

[79]: #parameters-19

[80]: #isboolean

[81]: #parameters-20

[82]: #ensurejsfileext

[83]: #parameters-21

[84]: #inspect

[85]: #parameters-22

[86]: #joinstrings

[87]: #parameters-23

[88]: #stringifyarray

[89]: #parameters-24

[90]: #numberordinalsuffix

[91]: #parameters-25

[92]: #servercom

[93]: #servercom-1

[94]: #behaviormetadata

[95]: #mdatapath

[96]: #workerid

[97]: #behaviormatches

[98]: #parameters-26

[99]: #removeitemfromrequirecache

[100]: #parameters-27

[101]: #loadbehaviormdata

[102]: #createreplyobj

[103]: #parameters-28

[104]: #onmsg

[105]: #parameters-29

[106]: #findbehavior

[107]: #parameters-30

[108]: #lookupbehavior-1

[109]: #parameters-31

[110]: #lookupbehaviorinfo

[111]: #parameters-32

[112]: #reloadbehaviors-1

[113]: #parameters-33

[114]: #allbehaviorinfo

[115]: #parameters-34

[116]: #behaviorlist

[117]: #parameters-35

[118]: #preparebehaviors

[119]: #parameters-36

[120]: #initroutes

[121]: #parameters-37

[122]: #initserver

[123]: #parameters-38

[124]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[125]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[126]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[127]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Symbol

[128]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[129]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[130]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[131]: #lookupworkerconfig

[132]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map

[133]: #lookupworker

[134]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[135]: #apiconfig

[136]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RegExp

[137]: https://developer.mozilla.org/docs/Web/API/MessagePort

[138]: #behaviorlookup
